@startuml
!theme plain
title "Fluxo de Segurança: Autenticação de Webhooks"

box "Sistemas Externos" #LightGray
actor "CRM Externo" as CRM
end box

box "Plataforma de Ingestão" #Thistle
participant "Gateway de Ingestão (Serverless Function)" as IngestionGateway
database "Serviço de Segredos (ex: Vault)" as SecretsManager
end box

== Autenticação de Webhooks (Sistemas Externos) ==

CRM -> IngestionGateway: POST /webhook/crm-event
note right of CRM: Header com o X-API-Key
activate IngestionGateway
IngestionGateway -> SecretsManager: Valida o X-API-Key
activate SecretsManager
SecretsManager --> IngestionGateway: Token é válido
deactivate SecretsManager
IngestionGateway -> IngestionGateway: Processa o payload do webhook
IngestionGateway --> CRM: Responde com 200 OK
deactivate IngestionGateway

@enduml
